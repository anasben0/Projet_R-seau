<div class="details-container">
  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Chargement...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="error-message">
    <h3>âŒ {{ error }}</h3>
    <button class="btn-back" (click)="goBack()">â† Retour aux hÃ©bergements</button>
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !error && accommodation" class="details-content">
    
    <!-- Header -->
    <div class="details-header">
      <button class="btn-back" (click)="goBack()">â† Retour</button>
      <h1>{{ accommodation.title }}</h1>
      <div class="header-info">
        <span class="city-badge">ğŸ“ {{ accommodation.city }}</span>
        <span class="host-info">ğŸ  ProposÃ© par {{ accommodation.hostName }}</span>
      </div>
    </div>

    <!-- Main Info Card -->
    <div class="info-card">
      <div class="info-section">
        <h2>ğŸ“‹ Informations</h2>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">ğŸ“ Adresse</span>
            <span class="value">{{ accommodation.address }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ‘¥ CapacitÃ© totale</span>
            <span class="value">{{ accommodation.capacity }} personne(s)</span>
          </div>
          <div class="info-item">
            <span class="label">âœ… Places disponibles</span>
            <span class="value available">{{ getAvailableSpots() }} place(s)</span>
          </div>
          <div class="info-item" *ngIf="accommodation.contact && (isHost || isAdmin)">
            <span class="label">ğŸ“ Contact</span>
            <span class="value">{{ accommodation.contact }}</span>
          </div>
        </div>
      </div>

      <!-- Progress bar -->
      <div class="capacity-progress">
        <div class="progress-info">
          <span>Occupation: {{ getAcceptedGuests().length }} / {{ accommodation.capacity }}</span>
          <span>{{ getAvailableSpots() }} place(s) disponible(s)</span>
        </div>
        <div class="progress-bar">
          <div 
            class="progress-fill" 
            [style.width.%]="(getAcceptedGuests().length / accommodation.capacity) * 100">
          </div>
        </div>
      </div>

      <!-- User Status & Actions -->
      <div class="user-actions">
        <!-- Si l'utilisateur n'a pas encore fait de demande -->
        <div *ngIf="!currentUserRequest && !isHost" class="action-section">
          <button 
            class="btn-join" 
            (click)="requestToJoin()"
            [disabled]="getAvailableSpots() === 0">
            <span *ngIf="getAvailableSpots() > 0">âœ‰ï¸ Demander Ã  rejoindre</span>
            <span *ngIf="getAvailableSpots() === 0">âŒ Complet</span>
          </button>
          <button class="btn-contact" (click)="contactHost()">
            ğŸ“§ Contacter l'hÃ©bergeur
          </button>
        </div>

        <!-- Si l'utilisateur a fait une demande -->
        <div *ngIf="currentUserRequest" class="request-status">
          <div class="status-badge" [ngClass]="getStatusBadgeClass(currentUserRequest.status)">
            {{ getStatusText(currentUserRequest.status) }}
          </div>
          
          <p *ngIf="currentUserRequest.status === 'requested'" class="status-message">
            â³ Votre demande est en attente de validation par l'hÃ©bergeur
          </p>
          <p *ngIf="currentUserRequest.status === 'accepted'" class="status-message success">
            âœ… Votre demande a Ã©tÃ© acceptÃ©e ! Vous Ãªtes maintenant dans la liste des personnes hÃ©bergÃ©es.
          </p>
          <p *ngIf="currentUserRequest.status === 'declined'" class="status-message declined">
            âŒ Votre demande a Ã©tÃ© refusÃ©e par l'hÃ©bergeur.
          </p>

          <button 
            *ngIf="currentUserRequest.status !== 'accepted'"
            class="btn-cancel" 
            (click)="cancelRequest()">
            Annuler ma demande
          </button>
          <button 
            *ngIf="currentUserRequest.status === 'accepted'"
            class="btn-leave" 
            (click)="cancelRequest()">
            Quitter l'hÃ©bergement
          </button>
        </div>

        <!-- Si c'est l'hÃ´te -->
        <div *ngIf="isHost" class="host-info-banner">
          ğŸ  Vous Ãªtes le propriÃ©taire de cet hÃ©bergement
        </div>
      </div>
    </div>

    <!-- Guests List -->
    <div class="guests-section">
      <h2>ğŸ‘¥ Personnes hÃ©bergÃ©es ({{ getAcceptedGuests().length }})</h2>
      
      <!-- Accepted Guests -->
      <div *ngIf="getAcceptedGuests().length > 0" class="guests-list">
        <div *ngFor="let guest of getAcceptedGuests()" class="guest-card accepted">
          <div class="guest-info">
            <div class="guest-avatar">ğŸ‘¤</div>
            <div class="guest-details">
              <h3>{{ guest.guestName }}</h3>
              <p class="guest-school" *ngIf="guest.guestSchool">ğŸ“ {{ guest.guestSchool }}</p>
              
              <!-- DÃ©tails complets pour hÃ´te et admin -->
              <div *ngIf="canSeeFullDetails(guest)" class="full-details">
                <p *ngIf="guest.guestEmail">ğŸ“§ {{ guest.guestEmail }}</p>
                <p *ngIf="guest.guestPhone">ğŸ“ {{ guest.guestPhone }}</p>
                <p class="join-date">ğŸ“… AcceptÃ© le {{ formatDate(guest.requestedAt) }}</p>
              </div>
            </div>
          </div>
          
          <!-- Actions pour l'hÃ´te UNIQUEMENT -->
          <div *ngIf="isHost" class="guest-actions">
            <button class="btn-remove" (click)="removeGuest(guest)">
              ğŸ—‘ï¸ Retirer
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="getAcceptedGuests().length === 0" class="no-guests">
        <p>Aucune personne hÃ©bergÃ©e pour le moment</p>
      </div>

      <!-- Pending Requests (visible UNIQUEMENT par l'hÃ´te) -->
      <div *ngIf="isHost && getPendingGuests().length > 0" class="pending-section">
        <h2>â³ Demandes en attente ({{ getPendingGuests().length }})</h2>
        <div class="guests-list">
          <div *ngFor="let guest of getPendingGuests()" class="guest-card pending">
            <div class="guest-info">
              <div class="guest-avatar">ğŸ‘¤</div>
              <div class="guest-details">
                <h3>{{ guest.guestName }}</h3>
                <p class="guest-school" *ngIf="guest.guestSchool">ğŸ“ {{ guest.guestSchool }}</p>
                <p>ğŸ“§ {{ guest.guestEmail }}</p>
                <p *ngIf="guest.guestPhone">ğŸ“ {{ guest.guestPhone }}</p>
                <p class="request-date">ğŸ“… Demande envoyÃ©e le {{ formatDate(guest.requestedAt) }}</p>
              </div>
            </div>
            
            <div class="guest-actions">
              <button class="btn-accept" (click)="acceptGuest(guest)">
                âœ… Accepter
              </button>
              <button class="btn-decline" (click)="declineGuest(guest)">
                âŒ Refuser
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Declined Requests (visible UNIQUEMENT par l'hÃ´te) -->
      <div *ngIf="isHost && getDeclinedGuests().length > 0" class="declined-section">
        <h2>âŒ Demandes refusÃ©es ({{ getDeclinedGuests().length }})</h2>
        <div class="guests-list collapsed">
          <div *ngFor="let guest of getDeclinedGuests()" class="guest-card declined">
            <div class="guest-info">
              <div class="guest-avatar">ğŸ‘¤</div>
              <div class="guest-details">
                <h3>{{ guest.guestName }}</h3>
                <p class="guest-school" *ngIf="guest.guestSchool">ğŸ“ {{ guest.guestSchool }}</p>
                <p class="request-date">ğŸ“… RefusÃ© le {{ formatDate(guest.requestedAt) }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
