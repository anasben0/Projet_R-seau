<div class="accommodations-container">
  <!-- Header -->
  <div class="accommodations-header">
    <div class="header-content">
      <button class="back-btn" (click)="goToDashboard()">
        â† Retour Ã  la CaRRte
      </button>
      <h1>ğŸ  HÃ©bergements Polytech</h1>
      <p>Trouvez un logement pour vos Ã©vÃ©nements rÃ©seau</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="accommodations-content">
    
    <!-- Message de filtre automatique -->
    <div *ngIf="selectedCity !== 'Toutes'" class="filter-notification">
      <span class="icon">ğŸ”</span>
      <span>HÃ©bergements filtrÃ©s pour <strong>{{ selectedCity }}</strong></span>
      <button class="clear-filter-btn" (click)="filterByCity('Toutes')">
        âœ• Voir tous les hÃ©bergements
      </button>
    </div>

    <!-- Section recherche -->
    <div class="search-section">
      <div class="search-bar">
        <span class="search-icon">ğŸ”</span>
        <input 
          type="text" 
          [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
          placeholder="Rechercher un hÃ©bergement par nom, adresse ou ville..."
          class="search-input">
      </div>
    </div>

    <!-- Filtres par ville -->
    <div class="filters-section">
      <h2>Filtrer par Ã©cole Polytech</h2>
      <div class="city-filters">
        <button 
          *ngFor="let city of availableCities" 
          class="filter-btn"
          [class.active]="selectedCity === city"
          (click)="filterByCity(city)">
          {{ city }}
        </button>
      </div>
    </div>

    <!-- Bouton Ajouter (Tous les utilisateurs connectÃ©s) -->
    <div class="user-section" *ngIf="isAdmin">
      <button class="add-btn" (click)="toggleAddForm()">
        {{ showAddForm ? 'âŒ Annuler' : 'â• Proposer mon hÃ©bergement' }}
      </button>
      <p class="help-text" *ngIf="!showAddForm">Vous pouvez proposer votre logement pour accueillir d'autres Ã©tudiants Polytech</p>
    </div>

    <!-- Formulaire d'ajout (Utilisateurs connectÃ©s) -->
    <div class="add-form-container" *ngIf="showAddForm && isAdmin">
      <h3>ğŸ  Proposer mon hÃ©bergement</h3>
      <p class="form-intro">Partagez votre logement avec d'autres Ã©tudiants du rÃ©seau Polytech !</p>
      <p class="info-note">â„¹ï¸ Votre hÃ©bergement sera automatiquement associÃ© Ã  votre Ã©cole Polytech</p>
      <form class="add-form" (ngSubmit)="addAccommodation()">
        <div class="form-group">
          <label>Titre *</label>
          <input 
            type="text" 
            [(ngModel)]="newAccommodation.title" 
            name="title"
            placeholder="Ex: Appartement T2 centre-ville"
            required>
        </div>

        <div class="form-group">
          <label>Adresse complÃ¨te *</label>
          <input 
            type="text" 
            [(ngModel)]="newAccommodation.address" 
            name="address"
            placeholder="Ex: 15 Rue de la RÃ©publique, Lyon"
            required>
        </div>

        <div class="form-group">
          <label>Ã‰vÃ©nement associÃ© *</label>
          <select 
            [(ngModel)]="newAccommodation.eventId" 
            name="eventId"
            required>
            <option value="">-- SÃ©lectionnez un Ã©vÃ©nement --</option>
            <option *ngFor="let event of availableEvents" [value]="event.id">
              {{ event.name }} - {{ event.dates }} {{ event.month }}
            </option>
          </select>
          <small class="form-hint">
            â„¹ï¸ Choisissez l'Ã©vÃ©nement pour lequel vous proposez cet hÃ©bergement
          </small>
        </div>

        <div class="form-group">
          <label>Description de votre logement (optionnel)</label>
          <textarea 
            [(ngModel)]="newAccommodation.description" 
            name="description"
            placeholder="Ex: Appartement calme, proche des transports. PossibilitÃ© de prÃªter un matelas..."
            rows="3"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>CapacitÃ© (nombre de places) *</label>
            <input 
              type="number" 
              [(ngModel)]="newAccommodation.capacity" 
              name="capacity"
              min="1"
              required>
          </div>
          <div class="form-group">
            <label>Contact (rempli automatiquement)</label>
            <input 
              type="text" 
              [(ngModel)]="newAccommodation.contact" 
              name="contact"
              placeholder="Votre email et tÃ©lÃ©phone"
              readonly
              title="Contact rempli automatiquement avec vos informations de compte">
          </div>
        </div>

        <button type="submit" class="submit-btn">
          âœ… Ajouter l'hÃ©bergement
        </button>
      </form>
    </div>

    <!-- Statistiques -->
    <div class="stats-section">
      <div class="stat-card">
        <div class="stat-icon">ğŸ </div>
        <div class="stat-content">
          <h3>{{ filteredAccommodations.length }}</h3>
          <p>HÃ©bergement(s) trouvÃ©(s)</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ›ï¸</div>
        <div class="stat-content">
          <h3>{{ getTotalAvailableSpots() }}</h3>
          <p>Place(s) disponible(s)</p>
        </div>
      </div>
    </div>

    <!-- Liste des hÃ©bergements -->
    <div class="accommodations-grid">
      <div 
        *ngFor="let accommodation of filteredAccommodations" 
        class="accommodation-card"
        [class.full]="getAvailableSpots(accommodation) === 0">
        
        <!-- Badge de disponibilitÃ© -->
        <div class="availability-badge" [ngClass]="getAvailabilityClass(accommodation)">
          {{ getAvailabilityText(accommodation) }}
        </div>

        <!-- Contenu de la carte -->
        <div class="card-header">
          <h3>{{ accommodation.title }}</h3>
          <span class="city-badge">ğŸ« Polytech {{ accommodation.schoolName || accommodation.city }}</span>
        </div>

        <div class="card-body">
          <div class="info-item">
            <span class="icon">ğŸ“</span>
            <span>{{ accommodation.address }}</span>
          </div>

          <div class="info-item">
            <span class="icon">ğŸ‘¥</span>
            <span>{{ getAvailableSpots(accommodation) }} / {{ accommodation.capacity }} places</span>
          </div>

          <div class="info-item" *ngIf="accommodation.contact">
            <span class="icon">ğŸ“</span>
            <span>{{ accommodation.contact }}</span>
          </div>

          <div class="progress-bar">
            <div 
              class="progress-fill" 
              [style.width.%]="(getAvailableSpots(accommodation) / accommodation.capacity) * 100"
              [ngClass]="getAvailabilityClass(accommodation)">
            </div>
          </div>
        </div>

        <div class="card-footer">
          <button 
            class="details-btn" 
            (click)="viewDetails(accommodation.id)">
            ğŸ‘ï¸ Voir dÃ©tails
          </button>
          <button 
            class="contact-btn" 
            (click)="contactAccommodation(accommodation)"
            [disabled]="getAvailableSpots(accommodation) === 0">
            <span *ngIf="getAvailableSpots(accommodation) > 0">ğŸ“§ Contacter</span>
            <span *ngIf="getAvailableSpots(accommodation) === 0">âŒ Complet</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Message si aucun hÃ©bergement -->
    <div *ngIf="filteredAccommodations.length === 0" class="no-results">
      <div class="no-results-icon">ğŸšï¸</div>
      <h3>Aucun hÃ©bergement trouvÃ©</h3>
      <p>Essayez de modifier vos critÃ¨res de recherche</p>
    </div>

  </div>
</div>
